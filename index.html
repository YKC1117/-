<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>棒球打席記錄表</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: center;
        }
        th {
            background-color: #f4f4f4;
        }
        input[type="text"], input[type="date"] {
            width: 150px;
            text-align: center;
        }
        #table-container {
            margin-top: 20px;
        }
        .result-table {
            margin-top: 20px;
            width: 100%;
            border-collapse: collapse;
        }
        .result-table th, .result-table td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: center;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
</head>
<body>

    <h2>棒球打席記錄表</h2>
    <!-- 比賽資訊 -->
    <form id="form">
        <div>
            <label>比賽日期：</label>
            <input type="date" id="match-date">
            <label>對手名稱：</label>
            <input type="text" id="opponent" placeholder="輸入對手名稱">
            <label>比分 (我方:對方)：</label>
            <input type="text" id="score" placeholder="例如: 5:3">
            <label>比賽地點：</label>
            <input type="text" id="venue" placeholder="輸入比賽地點">
        </div>
    </form>

    <!-- 打者輸入表格 -->
    <table>
        <thead>
            <tr>
                <th>打者名字</th>
                <th>第一打席</th>
                <th>第二打席</th>
                <th>第三打席</th>
                <th>第四打席</th>
                <th>第五打席</th>
                <th>第六打席</th>
            </tr>
        </thead>
        <tbody id="players-table-body">
            <!-- 這裡將由 JavaScript 動態生成 -->
        </tbody>
    </table>

    <button type="button" onclick="calculateStats()">匯出統計數據.JPG</button>

    <div id="table-container">
        <!-- 匯出的圖片會顯示在這裡 -->
    </div>

    <div id="result-container" style="display:none;">
        <h3>統計結果</h3>
        <p>
            <strong>比賽日期：</strong><span id="display-date"></span>　
            <strong>對手名稱：</strong><span id="display-opponent"></span>　
            <strong>比分：</strong><span id="display-score"></span>　
            <strong>比賽地點：</strong><span id="display-venue"></span>
        </p>
        <table class="result-table" id="result-table">
            <thead>
                <tr>
                    <th>打者名字</th>
                    <th>打席結果</th>
                    <th>打擊率 (BA)</th>
                    <th>上壘率 (OBP)</th>
                </tr>
            </thead>
            <tbody>
                <!-- 統計結果將在這裡顯示 -->
            </tbody>
        </table>
    </div>

    <script>
        // 動態生成 15 個打者的行
        const tableBody = document.getElementById('players-table-body');
        for (let i = 1; i <= 15; i++) {
            const row = document.createElement('tr');

            // 打者名字欄位
            const nameCell = document.createElement('td');
            const nameInput = document.createElement('input');
            nameInput.type = 'text';
            nameInput.name = `name${i}`;
            nameInput.placeholder = `打者 ${i} 名字`;
            nameCell.appendChild(nameInput);
            row.appendChild(nameCell);

            // 生成每個打席的下拉選單
            for (let j = 1; j <= 6; j++) {
                const cell = document.createElement('td');
                const select = document.createElement('select');
                select.name = `player${i}_atbat${j}`;
                ["未打擊", "1壘安", "2壘安", "3壘安", "全壘打", "四壞球", "三振", "觸身球", "失誤上壘", "接殺出局", "野手選擇"]
                    .forEach(option => {
                        const optionElement = document.createElement('option');
                        optionElement.value = option;
                        optionElement.textContent = option;
                        select.appendChild(optionElement);
                    });
                cell.appendChild(select);
                row.appendChild(cell);
            }

            // 將該行加入到表格中
            tableBody.appendChild(row);
        }

        // 計算結果並匯出為圖片
        function calculateStats() {
            // 比賽資訊顯示
            document.getElementById('display-date').textContent = document.getElementById('match-date').value;
            document.getElementById('display-opponent').textContent = document.getElementById('opponent').value || "未指定";
            document.getElementById('display-score').textContent = document.getElementById('score').value || "未提供";
            document.getElementById('display-venue').textContent = document.getElementById('venue').value || "未指定";

            const resultTableBody = document.getElementById('result-table').getElementsByTagName('tbody')[0];
            resultTableBody.innerHTML = ''; // 清空現有結果

            for (let i = 1; i <= 15; i++) {
                const nameInput = document.querySelector(`input[name="name${i}"]`);
                const name = nameInput.value || `打者 ${i}`;
                const atBats = [];

                for (let j = 1; j <= 6; j++) {
                    const select = document.querySelector(`select[name="player${i}_atbat${j}"]`);
                    atBats.push(select.value);
                }

                const hits = atBats.filter(result => ["1壘安", "2壘安", "3壘安", "全壘打"].includes(result)).length;
                const atBatsCount = atBats.filter(result => result !== "未打擊").length;

                const BA = atBatsCount ? (hits / atBatsCount).toFixed(3) : "0.000";
                const OBP = atBatsCount ? (hits / atBatsCount).toFixed(3) : "0.000";

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${name}</td>
                    <td>${atBats.join(", ")}</td>
                    <td>${BA}</td>
                    <td>${OBP}</td>
                `;
                resultTableBody.appendChild(row);
            }

            document.getElementById('result-container').style.display = 'block';

            // 匯出為圖片
            html2canvas(document.querySelector("#result-container")).then(function(canvas) {
                const imgData = canvas.toDataURL("image/jpeg");
                const link = document.createElement('a');
                link.href = imgData;
                link.download = 'baseball_stats.jpg';
                link.click();
            });
        }
    </script>

</body>
</html>
